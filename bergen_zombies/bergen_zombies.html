<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>taptapir</title><link rel="stylesheet" href="../taptapir.css"></head><body></body>
<script src="../taptapir/taptapir.js"></script>
<script src="spells.js"></script>
<script type='text/sunsnake'>


set_window_color('rgb(49 72 60)')
set_background_color('#050505')


menu = Scene('textures/bergen_003')
Button(parent=menu, text='Bergen\n Zombies', text_size=10, y=.4, text_color=color.blue, color=color.clear)
Button(parent=menu, text='Play', scale=[.35,.15], y=-.2, on_click=def():goto_scene(battle))


battle = Scene('textures/bergen_005')
bg_overlay = Entity(parent=battle, scale=2, color=color.dark_gray, alpha=.75)
card_parent = Entity(parent=battle, visible_self=False, z=-1)
enemy = Entity(parent=battle, scale=[.4,.6], color=color.azure, name='entity', value=20, text='zombie', y=.1, texture='https://game-icons.net/icons/ffffff/000000/1x1/delapouite/shambling-zombie.svg')
enemy.hp_bar = HealthBar(parent=battle, max=30, y=.5, scale=[.6,.075], bar_color=hsv(320,1,.8), shadow='#f00')
enemy_text = Button(parent=battle, x=enemy.hp_bar.x+.025, y=enemy.hp_bar.y+.06, z=0, text='Zombie', scale_y=.05, text_size=2, text_origin=[-.5,0], scale=enemy.hp_bar.scale, color=color.clear, text_color=color.light_gray)

energy_bar = HealthBar(parent=battle, max=10, y=-(.5*aspect_ratio)+.115, z=-2, scale=[.9,.04], bar_color=color.orange, shadow=True)
energy_bar.value = 5

hp_bar = HealthBar(parent=battle, max=100, y=-(.5*aspect_ratio)+.05, z=-3, scale=[.9,.075], bar_color=hsv(320,1,.8), shadow=True)


a =2
tooltip = Text(text='tooltip', scale=[.4,.2], z=-2, enabled=0, origin=[0,-.5], roundness=.1, color='#eee', alpha=.9, text_color='#222', text_size=2)
tooltip.el.style.wordWrap = 'break-word'
spell_names = ['Flamethrower', 'Shotgun', 'Bat', 'Rope', 'Nail_Gun', 'Bandages', 'Plank', 'Hunting_Rifle']
deck = [spells[e] for e in spell_names]
print('-------------', spells, deck)

for i in range(8):
    x = -.5 + .17 + (i%4)*.22
    y = -.35 - int(i>=4)*.22
    let slot = Entity(parent=card_parent, xy=[x,y], roundness=.02, color=hsv(0,0,.1,.8), shadow=0, z=1, scale=.2)
    let card = Entity(parent=card_parent, xy=[x,y], original_xy=[x,y], scale=[.18,.18], roundness=.1, draggable=True, shadow=True, color=random_color(), text_size=2, text_origin=[0,0])
    card.cooldown_overlay = Entity(parent=card, roundness=.5, enabled=False, text='3', text_origin=[0,0], scale=.8, alpha=.75, color=color.light_gray)
    card.spell = deck[i]
    card.energy_cost_icon = Entity(parent=card, roundness=.5, scale=.25, color=color.orange, xy=[.45,-.45], shadow=1, text=`${card.spell.cost}`, text_origin=[0,0], text_size=2, text_color=color.dark_gray)
    card.enabled = False
    update_can_use_card(card)
    // print('aaaaaaaaaaaaaaaaaaaaaaaa', card.spell.icon)
    if card.spell.icon:
        card.texture = card.spell.icon
    else:
        // card.texture = `textures/${card.spell.constructor.name}.png`.toLowerCase()
        card.text = card.spell.constructor.name.toLowerCase()

    after .1*(i+1):
        card.enabled = True

    card.on_click = def():
        tooltip.text = `${card.spell.constructor.name}\n${card.spell.description}`
        tooltip.enabled = True
        tooltip.x = card.x - .325 -  .65* int(card.original_xy[0] < 0)*-1
        tooltip.y = card.y - .1

    card.el.onmouseover = card.on_click

    card.while_dragging = def():
        card.z = -5
        tooltip.x = card.x - .325 -  .65* int(card.original_xy[0] < 0)*-1
        tooltip.y = card.y - .1
        if card.y > -.25:
            card.color = color.green
        else:
            card.color = color.white

    card.drop = def drop():
        if card.y > -.25:
            print('USE')
            card.use()
        card.xy = card.original_xy
        card.z = 0
        card.color = color.white
        tooltip.enabled = False

    card.use = def():
        print('USE')
        card.cooldown = card.spell.cooldown
        card.cooldown_overlay.enabled = True
        card.alpha=.5
        energy_bar.value -= card.spell.cost
        enemy.hp_bar.value -= card.spell.damage
        update_can_use_card(card)

// for spell in spells:
//     print('spell:', spell.constructor.name)
//     print(spell.description)
//     print(spell.damage)
//     print(spell.use)
//     print('spell.cost:', spell.cost)
//     print()

def update_can_use_card(card):
    card.draggable = energy_bar.value >= card.spell.cost

    if energy_bar.value < card.spell.cost:
        card.energy_cost_icon.color = hsv(0,.1,.5)
        card.energy_cost_icon.text_color = hsv(0,1,.2)
    else:
        card.energy_cost_icon.color = hsv(30,1,.9)
        card.energy_cost_icon.text_color = hsv(0,0,.2)

goto_scene(battle)


// goto_scene(menu)
</script><script src="../taptapir/sunsnake_compiler.js"></script></html>
