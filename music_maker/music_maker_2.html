<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <!-- <link rel="manifest" href="/manifest.json"> -->

    <!-- <title>snootboop.js</title> -->
    <link rel="stylesheet" href="../taptapir.css">
</head>

<body>
    <div id="game">
        <div id="loading_text">
        loading...<br><br><br><br><br><br><br>
        powered by taptapir
        </div>
    </div>

</body>

<script src="../taptapir.js"></script>


<script type='text/pokescript'>

set_orientation('horizontal')   // orientation
ASSETS_FOLDER = 'assets/'


symbols = ['‚òÄÔ∏è','üåô','üåü','ü™ê','üå†']
sample_names = ['UoIowaPiano_n24.wav','UoIowaPiano_n36.wav','UoIowaPiano_n48.wav','UoIowaPiano_n60.wav','UoIowaPiano_n72.wav']
for e in sample_names:
    var audio = new Audio(e)


bg_color = 'rgb(49 72 60)'
set_window_color(bg_color)
set_background_color('black')

note_view_parent = Entity(xy=[-.7,-.25], color='black', origin=[0,-.5], scale=.085)
notes = Array_2d(16, 8)
for y in range(8):
    for x in range(16):
        let e = Entity(parent=note_view_parent, xy=[x,y], on=False, scale=.95, roundness=.1)
        e.on_click = def():
            e.on = not e.on
            if e.on:
                e.color = 'cyan'
            else:
                e.color = 'white'

# sidebar for playing notes
for y in range(8):
    Entity(parent=note_view_parent, xy=[-1.2,y], color='cyan', roundness=.25)

Entity(parent=note_view_parent, xy=[-1.2,8], color='orange', roundness=.25, text='^')
Entity(parent=note_view_parent, xy=[-1.2,-1], color='orange', roundness=.25, text='v')

# top toolbar
Entity(parent=note_view_parent, xy=[.5,8.1], color='gray', roundness=.25, scale_x=1.9, text='copy')
Entity(parent=note_view_parent, xy=[2.5,8.1], color='gray', roundness=.25, scale_x=1.9, text='paste')
# set speed
for i in range(6):
    let e = Entity(parent=note_view_parent, xy=[i+4,8.1], color='gray', roundness=.25, scale_x=.95, text='a')
    e.text = ['.25', '.5', '1', '2', '4', '8'][i]


def convert_y_to_note(y):
    y = round(y*40)
    org_y = y
    octave = round(y/7)
    x = y - octave * 7
    print('x:', x)
    # org_y = y - (y/)
    # y += [2,1,2,2,2,1,2][x]
    y += 12
    print(org_y, '-->', 'octave:', octave, y)
    return y



def play():
    for note in notes:
        invoke(def anon():
            play_note(convert_y_to_note(note.y))
        , delay=note.x*2)


current_time = 0
play_button = Button(text='‚ñ∂Ô∏è', color='orange', scale=1/7, y=-.025, shadow=true)


# def play():
#     for y in range(5):
#         for x in range(8):
#             // invoke()
#             b = blocks[x][y]
#             if b.n:
#                 // let octave = Math.floor(b.n / 12)
#                 invoke(def test():
#                     play_note(blocks[x][y].n)
#                 , delay=x*.25)
#                 print('play note', blocks[x][y].n)
#                 // print(octave)

play_button.on_click = play

def play_note(n):
    print('a', n)
    octave = Math.floor(n / 12)
    // print('octave:', octave)
    var audio = new Audio(sample_names[octave])
    audio.volume = .5
    audio.mozPreservesPitch = false
    audio.preservesPitch = false
    audio.playbackRate = 2 ** ((n - (0 + 12*octave)) / 12)
    audio.play()

// w = 7
// keyboard = Array_2d(w, 5)
//
// for y in range(5):
//     for x in range(w):
//         offset = 0
//         // offset = y%2 * .05
//         let b = Button(x=-.5 + (x*1/w) + offset, y=-.7+(y*1/w), scale=1/w,  origin=[-.5,.5], color=rgb(x/3,x/7,y/7), shadow=1)
//         keyboard[x][y] = b
//         b.text_size = 2
//         b.n = 12 + y*12 + [2,3,5,7,9,10,12][x]
//         // b.n = 12 + y*12 + x
//         b.text = b.n
//         b.text_color = 'white'
//         // b.text_size = 2
//         // b.text = symbols[y]
//         // b.original_color = b.color
//         b.roundness = .5
//         // b.el.style.boxShadow = "10px 20px 30px rgb(19 12 10)"
//         // b.el.style.textAlign =  'center'
//
//         b.on_click = def():
//             // b.color = 'gold'
//             // invoke(def reset():
//             //     b.color = b.original_color
//             // , .1)
//             // n = 12 + y*12 + [2,3,5,7,9,10,12][x]
//             play_note(b.n)
//
//             // b.text = b.n
//             // b.text_color = 'white'
//
//
//             if current_block:
//                 current_block.color = b.color
//                 current_block.text = b.text
//                 current_block.set_note(b.n)
//                 print(current_block.n)


</script>
<script src="../pokescript_compiler.js"></script>
</html>
