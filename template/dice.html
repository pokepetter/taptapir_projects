<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>taptapir</title><link rel="stylesheet" href="../taptapir.css"></head><body></body><script src="../taptapir.js"></script><script type='text/pokescript'>

set_window_color('rgb(49 72 60)')
// set_scale(1)
# class Wallet extends Button:
#     # get gems():
#     #     return this._gems
#     set gems(value):
#         # this._gems = value
#         this.text = value
wallet = Button(scale=[.3,.075], origin=[-.5,.5], text_origin=[-.5,0], position=[-.5,.5*aspect_ratio], shadow=True, text=' ðŸ’Ž ??  ', gems=999)
wallet.set_gems = def (value):
    wallet.gems = value
    wallet.text = ` ðŸ’Ž ${wallet.gems}  `
    wallet.fit_to_text()

wallet.set_gems(99)

gem_hunt_start_bet_scene = Scene('market_crop')
# gem_hunt_start_bet_scene.on_enter = def ():
#     skulls_label.y = .35

num_mines = 3
multiplier = 1
current_bet = 1




# slider = Entity(parent=gem_hunt_start_bet_scene, y=.25-.03, origin=[0,-.5], color='#333', scale=[.95,.1], shadow=True, roundness=.2)
slider = Entity(parent=gem_hunt_start_bet_scene, x=.05, y=.25-.03, origin=[0,-.5], color='#333', scale=[.85,.1], shadow=True, roundness=.2)
skull_icon= Button(parent=slider, scale=[.12,1], origin=[0,0], text=`ðŸ’€`, text_size=4, color='#222', shadow=True, position=[-.575, .5, -1])
slider_text = Text(parent=slider, text=`${num_mines}/24`, y=.5, text_size=4, text_color='white', text_origin=[0,0])
multiplier_text = Text(parent=gem_hunt_start_bet_scene, text=`x ${multiplier}`, y=.155, x=.03, text_size=4, text_color='white', text_origin=[-.5,0])

multiplier = 1 + (num_mines / 24)
multiplier = Math.pow(multiplier, 3) -.1
multiplier = multiplier.toFixed(3);
multiplier_text.text = `x ${multiplier}`

fill = Entity(parent=slider, origin=[-.5,-.5], x=-.5, color='green', shadow=True, roundness=.2, scale_x=.2)
slider.on_click = def():
    num_mines = floor((mouse.point[0]+.5) * 24) + 1
    num_mines = clamp(num_mines, 1, 24)
    fill.scale_x = num_mines / 24
    # // print('num_mines:', num_mines)
    slider_text.text = `${num_mines}/24`
    # // print('aa', color.green, color.red, lerp(color.green, color.red, num_mines/25))
    # fill.color = lerp(color.green, color.red, num_mines/25)
    multiplier = 1 + (num_mines / 24)
    multiplier = Math.pow(multiplier, 3) -.1
    multiplier = multiplier.toFixed(3);
    multiplier_text.text = `x ${multiplier}`


skulls_label = Entity(visible_self=False, y=slider.y-.1)
# num_mines_text = Button(parent=skulls_label, scale=[.2,.1], text=`${num_mines}/25`, text_size=3, z=-2)

# bet_text = Button(parent=gem_hunt_start_bet_scene, scale=[.3*1.5,.075*1.5], text_origin=[-.5,0], y=-.4, shadow=True, text=`  ðŸ’Ž ${current_bet}`, text_size=4)
for i, e in enumerate([1, 5, 10, 20, 50, 100, 200, 500]):
    let b = Button(parent=gem_hunt_start_bet_scene, scale=[.2,.2], x=-.325+((i%4)*.22), y=(-int(i/4)*.22)-.15, text=`ðŸ’Ž${e}`, color='white', shadow=True)
    b.on_click = def ():
        current_bet = e
        start_game()

    if wallet.gems < e:
        b.color = 'black'
        b.alpha = .5
        b.text_color = 'darkred'
        b.shadow = False
        b.on_click = False

impact = Entity(texture='impact.gif', scale=.3, z=-100, enabled=False)

gem_hunt_play_scene = Scene('taptapir_stars')

squares = []
for y in range(5):
    for x in range(5):
        let e = Button(parent=gem_hunt_play_scene, scale=.2, xy=[(x/5)-.5, (y/5)-.5], origin=[-.5,-.5], text='?', color='#222', text_color='#fff', text_size=6, value='ðŸ’Ž', alpha=.95)
        squares.append(e)
        e.on_click = def():
            e.text = e.value
            if e.value == 'ðŸ’€':
                lose()
            else:
                print('win!')
                # e.on_click = None
                impact.xy = [(x/5)-.4, (y/5)-.4]
                impact.texture = impact.texture
                impact.enabled = True
                amount_won += int(current_bet * multiplier)
                cash_out_button.enabled = True
                back_button.enabled = False
                current_win_label.render()

amount_won = 0
def start_game():
    wallet.set_gems(wallet.gems - current_bet)

    for e in squares:
        e.value = 'ðŸ’Ž'
        e.text = '?'
        e.color = '#222'
        e.text_color = '#ccc'

    squares_copy = [e for e in squares]
    for i in range(num_mines):
        n = random_int(0, len(squares_copy)-1)
        target = squares_copy[n]
        target.value = 'ðŸ’€'
        # squares_copy.remove(e)
        squares_copy = [e for e in squares_copy if e != target]

    # num_mines_text.parent = gem_hunt_play_scene
    goto_scene(gem_hunt_play_scene)
    end_screen.enabled = False

    amount_won = -current_bet
    current_win_label.enabled = True
    current_win_label.render()


# current_win_label = Button(parent=gem_hunt_play_scene, text=`  fðŸ’Ž ${amount_won}`, y=-.55, text_size=4, text_color='white')
current_win_label = Button(parent=gem_hunt_play_scene, scale=[1,.075*1.5], text_origin=[0,0], origin=[0,0], xyz=[0,-.575,-1], shadow=True, text=`  ðŸ’Ž ${amount_won} `, text_size=4, color='#4e6e26', roundness=.5)
current_win_label.render = def():
    current_win_label.text = `  ðŸ’Ž ${amount_won}  `
    current_win_label.fit_to_text()
    if amount_won >= 0:
        current_win_label.text_color = 'white'
    else:
        current_win_label.text_color = 'darkred'



cash_out_button = Button(parent=gem_hunt_play_scene, y=-.6, z=0, text='cash out', scale=[.5,.25], origin=[0,.5], color='yellow', shadow=True, enabled=False, on_click=win)
end_screen = Entity(parent=gem_hunt_play_scene, visible_self=False, enabled=False)
overlay = Entity(parent=end_screen, color='black', alpha=.75, scale=[1,1*aspect_ratio], roundness=.05, on_click=True, z=-3)
lose_text = Text(parent=end_screen, text='YOU LOST :(', text_origin=[0,0], text_size=5, z=-4)

def reveal_all()
    bet_text_retry.text = `  ðŸ’Ž ${current_bet} `
    bet_text_retry.fit_to_text()
    has_enough_for_retry = wallet.gems > current_bet
    # has_enough_for_retry = True
    retry_button.enabled = has_enough_for_retry
    bet_text_retry.enabled = has_enough_for_retry
    for e in squares:
        e.text = e.value

def win():
    reveal_all()
    end_screen.enabled = True
    # lose_text.enabled = False
    lose_text.text = `YOU WON ðŸ’Ž${amount_won} :D:D`
    lose_text.text_color = 'yellow'

    cash_out_button.enabled = False
    current_win_label.enabled = False
    wallet.set_gems(wallet.gems + amount_won)


def lose():
    reveal_all()
    cash_out_button.enabled = False
    end_screen.enabled = True

    lose_text.text = `YOU LOST :(`
    lose_text.text_color = 'darkred'

    amount_won = current_bet
    current_win_label.enabled = False
    # current_win_label.render()
    # gem_hunt_start_bet_scene.enabled=triUTCemLF3ne

retry_button = Button(parent=end_screen, y=-.35, z=-4, text='ðŸ—˜', scale=[.4,.25], color='#738', shadow=True, text_size=4, text_color='white', on_click=start_game)
bet_text_retry = Button(parent=end_screen, scale=[.2,.075], text_origin=[-.5,0], y=retry_button.y+.12, z=-4, text=`  ðŸ’Ž ${current_bet}`, text_size=2.5, padding=.3)
back_button = Button(parent=end_screen, y=-.35, x=-.45, z=-4, origin=[-.5,0], text='<<', scale=[.2,.25], color='#287', shadow=True, text_color='white')
back_button.on_click = def():
    goto_scene(gem_hunt_start_bet_scene)
    end_screen.enabled = False
# back_button.on_click = def():
#     goto_scene(gem_hunt_start_bet_scene)
goto_scene(gem_hunt_start_bet_scene, fade=false)
# goto_scene(gem_hunt_play_scene, fade=false)
# start_game()
# lose()
# end_screen.enabled = True

</script><script src="../pokescript_compiler.js"></script></html>
